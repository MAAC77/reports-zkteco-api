datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
    // previewFeatures = []
}

generator dbml {
    provider = "prisma-dbml-generator"
}

model Parametro {
    id    String @id @default(uuid())
    grupo String
    clave String
    valor String

    @@map("parametros")
}

model Usuario {
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    id        String   @id @default(uuid())
    usuario   String   @db.VarChar(30)
    password  String
    correo    String   @unique
    rol       RolEnum
    idPersona String

    persona        Persona          @relation(fields: [idPersona], references: [id])
    HorarioUsuario HorarioUsuario[]
    Marcacion      Marcacion[]
    UnidadUsuario  UnidadUsuario[]

    @@map("usuarios")
}

model Persona {
    id              String    @id @default(uuid())
    nombres         String
    primerApellido  String    @map("primer_apellido")
    segundoApellido String?   @map("segundo_apellido")
    nroDocumento    String    @map("nro_documento")
    genero          String
    telefono        Int?
    celular         Int
    Usuario         Usuario[]

    @@map("personas")
}

model Unidad {
    id            String          @id @default(uuid())
    nombre        String
    descripcion   String?
    UnidadUsuario UnidadUsuario[]

    @@map("unidades")
}

model UnidadUsuario {
    id        String  @id @default(uuid())
    cargo     String
    idUsuario String
    idUnidad  String
    usuario   Usuario @relation(fields: [idUsuario], references: [id])
    unidad    Unidad  @relation(fields: [idUnidad], references: [id])

    @@map("unidad_personas")
}

model Horario {
    createdAt      DateTime         @default(now())
    updatedAt      DateTime         @updatedAt
    id             String           @id @default(uuid())
    nombre         String
    descripcion    String
    HorarioDetalle HorarioDetalle[]
    HorarioUsuario HorarioUsuario[]

    @@map("horarios")
}

model HorarioDetalle {
    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt
    id            String   @id @default(uuid())
    horaEntrada   String   @map("hora_entrada")
    horaSalida    String   @map("hora_salida")
    entradaMaxima String   @map("entrada_maxima")
    entradaMinima String   @map("entrada_minima")
    salidaMaxima  String   @map("salida_maxima")
    salidaMinima  String   @map("salida_minima")
    lunes         Boolean
    martes        Boolean
    miercoles     Boolean
    jueves        Boolean
    viernes       Boolean
    tolerancia    Int
    idHorario     String   @map("id_horario")
    horario       Horario  @relation(fields: [idHorario], references: [id])

    @@map("horarios_detalles")
}

model HorarioUsuario {
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    id        String   @id @default(uuid())
    idHorario String   @map("id_horario")
    idUsuario String   @map("id_usuario")

    horario   Horario     @relation(fields: [idHorario], references: [id])
    usuario   Usuario     @relation(fields: [idUsuario], references: [id])
    Marcacion Marcacion[]

    @@map("horarios_usuarios")
}

model Marcacion {
    createdAt        DateTime       @default(now())
    updatedAt        DateTime       @updatedAt
    id               BigInt         @id @default(autoincrement())
    hora             String
    fecha            String
    idUsuario        String         @map("id_usuario")
    idHorarioUsuario String         @map("id_horario_usuario")
    usuario          Usuario        @relation(fields: [idUsuario], references: [id])
    horarioUsuario   HorarioUsuario @relation(fields: [idHorarioUsuario], references: [id])

    @@map("marcaciones")
}

enum RolEnum {
    ADMINISTRADOR
    USUARIO
}
